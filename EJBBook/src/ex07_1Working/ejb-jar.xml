<?xml version="1.0"?>

<!DOCTYPE ejb-jar PUBLIC "-//Sun Microsystems, Inc.//DTD Enterprise JavaBeans 2.0//EN" "http://java.sun.com/dtd/ejb-jar_2_0.dtd">

<ejb-jar>
 <enterprise-beans>
   <entity>
      <ejb-name>CustomerEJB</ejb-name>
      <local-home>com.titan.customer.CustomerHomeLocal</local-home>
      <local>com.titan.customer.CustomerLocal</local>
      <ejb-class>com.titan.customer.CustomerBean</ejb-class>
      <persistence-type>Container</persistence-type>
      <prim-key-class>java.lang.Integer</prim-key-class>
      <reentrant>False</reentrant>
      <cmp-version>2.x</cmp-version>
      <abstract-schema-name>Customer</abstract-schema-name>
	  <cmp-field><field-name>id</field-name></cmp-field>
      <cmp-field><field-name>lastName</field-name></cmp-field>
      <cmp-field><field-name>firstName</field-name></cmp-field>
      <cmp-field><field-name>hasGoodCredit</field-name></cmp-field>
      <primkey-field>id</primkey-field>
      <security-identity><use-caller-identity/></security-identity>
   </entity>
   <entity>
      <ejb-name>AddressEJB</ejb-name>
	  <local-home>com.titan.address.AddressHomeLocal</local-home>	
	  <local>com.titan.address.AddressLocal</local>
	  <ejb-class>com.titan.address.AddressBean</ejb-class>	
      <persistence-type>Container</persistence-type>
      <prim-key-class>java.lang.Integer</prim-key-class>
      <reentrant>False</reentrant>
      <cmp-version>2.x</cmp-version>
      <abstract-schema-name>Address</abstract-schema-name> 
	  <cmp-field><field-name>id</field-name></cmp-field>
      <cmp-field><field-name>street</field-name></cmp-field>
      <cmp-field><field-name>city</field-name></cmp-field>
      <cmp-field><field-name>state</field-name></cmp-field>
      <cmp-field><field-name>zip</field-name></cmp-field>
      <primkey-field>id</primkey-field>
	  <security-identity><use-caller-identity/></security-identity>
   </entity>
   <entity>
      <ejb-name>CreditCardEJB</ejb-name>							
	  <local-home>com.titan.customer.CreditCardHomeLocal</local-home>
	  <local>com.titan.customer.CreditCardLocal</local>
	  <ejb-class>com.titan.customer.CreditCardBean</ejb-class>
      <persistence-type>Container</persistence-type>
      <prim-key-class>java.lang.Integer</prim-key-class>
      <reentrant>False</reentrant>
      <cmp-version>2.x</cmp-version>
      <abstract-schema-name>CreditCard</abstract-schema-name>
	  <cmp-field><field-name>id</field-name></cmp-field>
      <cmp-field><field-name>expirationDate</field-name></cmp-field>
      <cmp-field><field-name>number</field-name></cmp-field>
      <cmp-field><field-name>nameOnCard</field-name></cmp-field>
      <cmp-field><field-name>creditOrganization</field-name></cmp-field>
      <primkey-field>id</primkey-field>
	  <security-identity><use-caller-identity/></security-identity>
   </entity>
   <entity>
      <ejb-name>PhoneEJB</ejb-name>							
	  <local-home>com.titan.phone.PhoneHomeLocal</local-home>
	  <local>com.titan.phone.PhoneLocal</local>
	  <ejb-class>com.titan.phone.PhoneBean</ejb-class>
      <persistence-type>Container</persistence-type>
      <prim-key-class>java.lang.Integer</prim-key-class>
      <reentrant>False</reentrant>
      <cmp-version>2.x</cmp-version>
      <abstract-schema-name>Phone</abstract-schema-name>
	  <cmp-field><field-name>id</field-name></cmp-field>
      <cmp-field><field-name>number</field-name></cmp-field>
      <cmp-field><field-name>type</field-name></cmp-field>
      <primkey-field>id</primkey-field>
	  <security-identity><use-caller-identity/></security-identity>
   </entity>
 </enterprise-beans>

    <relationships>

		<ejb-relation>
			<ejb-relation-name>Customer-HomeAddress</ejb-relation-name>
			<ejb-relationship-role>
				<ejb-relationship-role-name>
					Customer-has-a-Address
				</ejb-relationship-role-name>
				<multiplicity>one</multiplicity>
				<relationship-role-source>
					<ejb-name>CustomerEJB</ejb-name>
				</relationship-role-source>
				<cmr-field>
					<cmr-field-name>homeAddress</cmr-field-name>
				</cmr-field>
			</ejb-relationship-role>
			<ejb-relationship-role>
				<ejb-relationship-role-name>
					Address-belongs-to-Customer
				</ejb-relationship-role-name>
				<multiplicity>one</multiplicity>
				<relationship-role-source>
					<ejb-name>AddressEJB</ejb-name>
				</relationship-role-source>
			</ejb-relationship-role>
		</ejb-relation>

		<ejb-relation>
			<ejb-relation-name>Customer-CreditCard</ejb-relation-name>
			<ejb-relationship-role>
				<ejb-relationship-role-name>
					Customer-has-a-CreditCard
				</ejb-relationship-role-name>
				<multiplicity>one</multiplicity>	
				<relationship-role-source>
					<ejb-name>CustomerEJB</ejb-name>
				</relationship-role-source>
				<cmr-field>
					<cmr-field-name>creditCard</cmr-field-name>
				</cmr-field>
			</ejb-relationship-role>
			<ejb-relationship-role>
				<ejb-relationship-role-name>
					CreditCard-belongs-to-Customer
				</ejb-relationship-role-name>
				<multiplicity>one</multiplicity>
				<relationship-role-source>
					<ejb-name>CreditCardEJB</ejb-name>
				</relationship-role-source>
				<cmr-field>
					<cmr-field-name>customer</cmr-field-name>
				</cmr-field>
			</ejb-relationship-role>
		</ejb-relation>	

		<ejb-relation>
			<ejb-relation-name>Customer-Phones</ejb-relation-name>
			<ejb-relationship-role>
				<ejb-relationship-role-name>
					Customer-has-many-Phone-numbers
				</ejb-relationship-role-name>
				<multiplicity>one</multiplicity>	
				<relationship-role-source>
					<ejb-name>CustomerEJB</ejb-name>
				</relationship-role-source>
				<cmr-field>
					<cmr-field-name>phoneNumbers</cmr-field-name>
					<cmr-field-type>java.util.Collection</cmr-field-type>
				</cmr-field>
			</ejb-relationship-role>
			<ejb-relationship-role>
				<ejb-relationship-role-name>
					Phone-belongs-to-Customer
				</ejb-relationship-role-name>
				<multiplicity>many</multiplicity>
				<relationship-role-source>
					<ejb-name>PhoneEJB</ejb-name>
				</relationship-role-source>
			</ejb-relationship-role>
		</ejb-relation>	

    </relationships>

    <assembly-descriptor>
        <security-role>
            <role-name>Employees</role-name>
        </security-role>
        <method-permission>
            <role-name>Employees</role-name>
            <method>
                <ejb-name>CustomerEJB</ejb-name>
                <method-name>*</method-name>
            </method>
            <method>
                <ejb-name>AddressEJB</ejb-name>
                <method-name>*</method-name>
            </method>
            <method>
                <ejb-name>CreditCardEJB</ejb-name>
                <method-name>*</method-name>
            </method>
            <method>
                <ejb-name>PhoneEJB</ejb-name>
                <method-name>*</method-name>
            </method>
        </method-permission>
        <container-transaction>
            <method>
                <ejb-name>CustomerEJB</ejb-name>
                <method-name>*</method-name>
            </method>
            <method>
                <ejb-name>AddressEJB</ejb-name>
                <method-name>*</method-name>
            </method>
            <method>
                <ejb-name>CreditCardEJB</ejb-name>
                <method-name>*</method-name>
            </method>
            <method>
                <ejb-name>PhoneEJB</ejb-name>
                <method-name>*</method-name>
            </method>
            <trans-attribute>Required</trans-attribute>
        </container-transaction>
    </assembly-descriptor>  

</ejb-jar>
